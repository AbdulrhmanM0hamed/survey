# ๐ ูุธุงู ุงูุดุฑูุท - Condition System

## ูุธุฑุฉ ุนุงูุฉ

ูุธุงู ุงูุดุฑูุท ูู ุงูุชุทุจูู ูุณูุญ ุจุฅูุดุงุก ุงุณุชุจูุงูุงุช ุฏููุงููููุฉ ุญูุซ ุชุชุบูุฑ ุงูุฃุณุฆูุฉ ูุงูุฃูุณุงู ุจูุงุกู ุนูู ุฅุฌุงุจุงุช ุงููุณุชุฎุฏู.

---

## ๐ ุงูููุงููู ุงูุฃุณุงุณูุฉ

### 1. **Source Conditions (ุงูุดุฑูุท ุงููุตุฏุฑูุฉ)**

ุงูุดุฑูุท ุงูุชู **ููุดุฆูุง** ุงูุณุคุงู ุงูุญุงูู ููุคุซุฑ ุจูุง ุนูู ุนูุงุตุฑ ุฃุฎุฑู.

```json
"sourceConditions": [
  {
    "id": 11,
    "sourceQuestionId": 10850,  // ุงูุณุคุงู ุงููุตุฏุฑ (ูุฐุง ุงูุณุคุงู)
    "targetType": 2,             // ุงููุฏู: Group
    "targetGroupId": 83,         // ุงููุฌููุนุฉ ุงููุณุชูุฏูุฉ
    "action": 4,                 // ุงูุฅุฌุฑุงุก: Repetition
    "operator": 11,              // ุงูููุนุงูู: RepeatForCount
    "value": null
  }
]
```

**ูุนูู:** ุนูุฏูุง ููุฌูุจ ุงููุณุชุฎุฏู ุนูู ูุฐุง ุงูุณุคุงูุ ุณูุชูุฑุฑ ุงูู Group 83 ุจูุงุกู ุนูู ุงููููุฉ ุงูููุฏุฎูุฉ.

### 2. **Target Conditions (ุงูุดุฑูุท ุงููุณุชูุฏูุฉ)**

ุงูุดุฑูุท ุงูุชู **ุชุคุซุฑ ุนูู** ุงูุนูุตุฑ ุงูุญุงูู ูู ุฃุณุฆูุฉ ุฃู ุดุฑูุท ุฃุฎุฑู.

```json
"targetConditions": [
  {
    "id": 12,
    "sourceQuestionId": 10851,  // ุงูุณุคุงู ุงูุฐู ูุชุญูู ุจู
    "targetQuestionId": 10852,  // ุฃูุง (ุงูุณุคุงู ุงููุณุชูุฏู)
    "action": 1,                // ุงูุฅุฌุฑุงุก: Show
    "operator": 1,              // ุงูููุนุงูู: Equals
    "value": "YES"              // ุงููููุฉ: "ูุนู"
  }
]
```

**ูุนูู:** ูุฐุง ุงูุณุคุงู ุณูุธูุฑ ููุท ุฅุฐุง ูุงูุช ุฅุฌุงุจุฉ ุงูุณุคุงู 10851 = "YES".

---

## ๐ฏ ุฃููุงุน ุงูุฃูุฏุงู (Target Types)

| ุงูููุน | ุงููููุฉ | ุงููุตู | ูุซุงู |
|------|-------|-------|------|
| **Question** | 1 | ุงูุณุคุงู | ุฅุธูุงุฑ/ุฅุฎูุงุก ุณุคุงู ูุนูู |
| **Group** | 2 | ุงููุฌููุนุฉ | ุชูุฑุงุฑ ูุฌููุนุฉ ุฃุณุฆูุฉ |
| **Section** | 3 | ุงููุณู | ุฅุธูุงุฑ/ุฅุฎูุงุก ูุณู ูุงูู |

---

## โก ุฃููุงุน ุงูุฅุฌุฑุงุกุงุช (Actions)

| ุงูุฅุฌุฑุงุก | ุงููููุฉ | ุงููุตู | ูุซุงู ูู ุงูุจูุงูุงุช |
|---------|-------|-------|------------------|
| **Show** | 1 | ุฅุธูุงุฑ ุงูุนูุตุฑ | ุฅุธูุงุฑ ุณุคุงู ุงูุฏูู ุฅุฐุง ูุงู ููุงู ุฏููู |
| **Hide** | 2 | ุฅุฎูุงุก ุงูุนูุตุฑ | ุฅุฎูุงุก ุณุคุงู ุงูุชุนููู ุฅุฐุง ูุงู ุฑุงุถูุงู ุชูุงูุงู |
| **Require** | 3 | ุฌุนู ุงูุณุคุงู ูุทููุจุงู | - |
| **Repetition** | 4 | ุชูุฑุงุฑ ุงููุฌููุนุฉ | ุชูุฑุงุฑ ุจูุงูุงุช ุงูุฃูุฑุงุฏ ุญุณุจ ุนุฏุฏูู |
| **Disable** | 5 | ุชุนุทูู ุงูุณุคุงู | - |

---

## ๐ข ุงููุนุงููุงุช (Operators)

| ุงููุนุงูู | ุงููููุฉ | ุงููุตู | ูุซุงู |
|---------|-------|-------|------|
| **Equals** | 1 | ูุณุงูู | `"YES" == "YES"` |
| **NotEquals** | 2 | ูุง ูุณุงูู | `"NO" != "YES"` |
| **GreaterThan** | 3 | ุฃูุจุฑ ูู | `5 > 3` |
| **LessThan** | 4 | ุฃูู ูู | `2 < 5` |
| **GreaterThanOrEqual** | 5 | ุฃูุจุฑ ูู ุฃู ูุณุงูู | `5 >= 5` |
| **LessThanOrEqual** | 6 | ุฃูู ูู ุฃู ูุณุงูู | `3 <= 5` |
| **Contains** | 7 | ูุญุชูู ุนูู | `"Hello" contains "ell"` |
| **StartsWith** | 8 | ูุจุฏุฃ ุจู | `"Hello" starts with "Hel"` |
| **EndsWith** | 9 | ููุชูู ุจู | `"Hello" ends with "llo"` |
| **In** | 10 | ุถูู ูุงุฆูุฉ | `"A" in ["A","B","C"]` |
| **RepeatForCount** | 11 | ุชูุฑุงุฑ ุจุงูุนุฏุฏ | ุนุฏุฏ ุงูุฃูุฑุงุฏ = 5 โ ูุฑุฑ 5 ูุฑุงุช |

---

## ๐ ุฃูุซูุฉ ูู ุงูุจูุงูุงุช ุงููุนููุฉ

### ูุซุงู 1: ุชูุฑุงุฑ ุงููุฌููุนุฉ (Repetition)

**ุงูุณููุงุฑูู:** ุนุฏุฏ ุฃูุฑุงุฏ ุงูุฃุณุฑุฉ ูุญุฏุฏ ุนุฏุฏ ูุฑุงุช ุชูุฑุงุฑ ุจูุงูุงุช ุงูุฃูุฑุงุฏ.

```json
{
  "code": "HH_MEMBERS_COUNT",
  "text": "ูู ุนุฏุฏ ุฃูุฑุงุฏ ุงูุฃุณุฑุฉ ุงููููููู ุจุดูู ุฏุงุฆูุ",
  "type": 1,  // Integer
  "id": 10850,
  "sourceConditions": [
    {
      "id": 11,
      "targetType": 2,              // Group
      "targetGroupId": 83,          // ูุฌููุนุฉ ุจูุงูุงุช ุงูุฃูุฑุงุฏ
      "action": 4,                  // Repetition
      "operator": 11,               // RepeatForCount
      "description": "ุชูุฑุงุฑ ุฌุฑูุจ ุจูุงูุงุช ุงูุฃูุฑุงุฏ ุจุนุฏุฏ ุฃูุฑุงุฏ ุงูุฃุณุฑุฉ."
    }
  ]
}
```

**ุงููุชูุฌุฉ:**
- ุงููุณุชุฎุฏู ูุฏุฎู: `5`
- ุงููุฌููุนุฉ 83 ุชุชูุฑุฑ 5 ูุฑุงุช
- ูุธูุฑ 5 ููุงุฐุฌ ูุจูุงูุงุช ุงูุฃูุฑุงุฏ

---

### ูุซุงู 2: ุฅุธูุงุฑ ุณุคุงู ูุดุฑูุท (Show)

**ุงูุณููุงุฑูู:** ุฅุธูุงุฑ ุณุคุงู ูููุฉ ุงูุฏูู ููุท ุฅุฐุง ูุงู ููุงู ุฏููู.

```json
{
  "code": "HH_HAS_DEBTS",
  "text": "ูู ุนูู ุงูุฃุณุฑุฉ ูู ุงูููุช ุงูุญุงูู ุฃู ุฏููู ูุณุชุญูุฉุ",
  "type": 4,  // Single Choice
  "id": 10851,
  "sourceConditions": [
    {
      "id": 12,
      "targetType": 1,              // Question
      "targetQuestionId": 10852,    // ุณุคุงู ูููุฉ ุงูุฏูู
      "action": 1,                  // Show
      "operator": 1,                // Equals
      "value": "YES"
    }
  ]
}
```

**ุงููุชูุฌุฉ:**
- ุงููุณุชุฎุฏู ูุฎุชุงุฑ: `ูุนู`
- ุณุคุงู "ูููุฉ ุงูุฏูู" ูุธูุฑ
- ุงููุณุชุฎุฏู ูุฎุชุงุฑ: `ูุง`
- ุณุคุงู "ูููุฉ ุงูุฏูู" ูุฎุชูู

---

### ูุซุงู 3: ุฅุธูุงุฑ ูุณู ูุงูู (Section Show)

**ุงูุณููุงุฑูู:** ุฅุธูุงุฑ ูุณู ุงูุฑุถุง ููุท ุฅุฐุง ูุงูุช ุงูุฃุณุฑุฉ ุนูููุง ุฏููู.

```json
{
  "code": "HH_HAS_DEBTS",
  "id": 10851,
  "sourceConditions": [
    {
      "id": 13,
      "targetType": 3,              // Section
      "targetSectionId": 10059,     // ูุณู ุงูุฑุถุง
      "action": 1,                  // Show
      "operator": 1,                // Equals
      "value": "YES"
    }
  ]
}
```

**ุงููุชูุฌุฉ:**
- ุงููุณุชุฎุฏู ูุฎุชุงุฑ: `ูุนู`
- ุงููุณู ุงูุซุงูู (ูุณุชูู ุงูุฑุถุง) ูุธูุฑ ุจุงููุงูู
- ุงููุณุชุฎุฏู ูุฎุชุงุฑ: `ูุง`
- ุงููุณู ุงูุซุงูู ูุฎุชูู

---

### ูุซุงู 4: ุฅุฎูุงุก ุณุคุงู (Hide)

**ุงูุณููุงุฑูู:** ุฅุฎูุงุก ุณุคุงู ุงูุชุนููู ุฅุฐุง ูุงู ุงููุดุงุฑู ุฑุงุถูุงู ุชูุงูุงู.

```json
{
  "code": "SAT_OVERALL_LIFE",
  "text": "ุจุดูู ุนุงูุ ูุง ูุฏู ุฑุถุงู ุนู ูุณุชูู ุงููุนูุดุฉ ุงูุญุงูู ููุฃุณุฑุฉุ",
  "type": 4,  // Single Choice
  "id": 10857,
  "sourceConditions": [
    {
      "id": 14,
      "targetType": 1,              // Question
      "targetQuestionId": 10858,    // ุณุคุงู ุงูุชุนููู
      "action": 2,                  // Hide
      "operator": 1,                // Equals
      "value": "VERY_SATISFIED"
    }
  ]
}
```

**ุงููุชูุฌุฉ:**
- ุงููุณุชุฎุฏู ูุฎุชุงุฑ: `ุฑุงุถู ุชูุงูุงู`
- ุณุคุงู "ุฃุณุจุงุจ ุนุฏู ุงูุฑุถุง" ูุฎุชูู (ุบูุฑ ููุทูู ุฃู ูุธูุฑ)
- ุงููุณุชุฎุฏู ูุฎุชุงุฑ: ุฃู ุฎูุงุฑ ุขุฎุฑ
- ุณุคุงู "ุฃุณุจุงุจ ุนุฏู ุงูุฑุถุง" ูุธูุฑ

---

## ๐ ุฏูุฑุฉ ุชูููุฐ ุงูุดุฑูุท (Execution Cycle)

```
1. ุชุญููู ุงูุงุณุชุจูุงู
   โ
2. ุชููุฆุฉ ุงูุญุงูุฉ ุงูุงูุชุฑุงุถูุฉ ูุฌููุน ุงูุนูุงุตุฑ
   โ
3. ุชูููู ุฌููุน ุงูุดุฑูุท (_evaluateAllConditions)
   โ
4. ุงููุณุชุฎุฏู ููุฌูุจ ุนูู ุณุคุงู
   โ
5. ุญูุธ ุงูุฅุฌุงุจุฉ ูู Repository
   โ
6. ุฅุนุงุฏุฉ ุชููุฆุฉ ุงูุญุงูุฉ (_resetConditionsToDefault)
   โ
7. ุฅุนุงุฏุฉ ุชูููู ุฌููุน ุงูุดุฑูุท
   โ
8. notifyListeners() โ ุชุญุฏูุซ ุงููุงุฌูุฉ
   โ
9. ุงูุฃุณุฆูุฉ/ุงููุฌููุนุงุช/ุงูุฃูุณุงู ุชุธูุฑ/ุชุฎุชูู ุชููุงุฆูุงู
```

---

## ๐ป ุงูุชุทุจูู ุงูุชููู

### ูู ViewModel

```dart
// ุนูุฏ ุญูุธ ุฅุฌุงุจุฉ
Future<void> saveAnswer({...}) async {
  // 1. ุญูุธ ุงูุฅุฌุงุจุฉ
  await repository.saveAnswer(...);
  
  // 2. ุชุญุฏูุซ ุงูุฅุฌุงุจุงุช ุงููุญููุฉ
  _surveyAnswers = _surveyAnswers!.copyWith(answers: updatedAnswers);
  
  // 3. ุฅุนุงุฏุฉ ุชูููู ุฌููุน ุงูุดุฑูุท
  _evaluateAllConditions();
  
  // 4. ุชุญุฏูุซ ุงููุงุฌูุฉ
  notifyListeners();
}
```

### ูู ุงูุดุงุดุฉ

```dart
// Consumer ูุณุชูุน ููุชุบููุฑุงุช ุชููุงุฆูุงู
Consumer<SurveyDetailsViewModel>(
  builder: (context, viewModel, child) {
    // ุนูุฏูุง ูุชู ุงุณุชุฏุนุงุก notifyListeners()
    // ูุฐุง ุงูู builder ููุนุงุฏ ุจูุงุคู ุชููุงุฆูุงู
    
    final sections = viewModel.visibleSections; // ุชูุญุฏุซ ุชููุงุฆูุงู
    final groups = viewModel.getVisibleGroups(section); // ุชูุญุฏุซ ุชููุงุฆูุงู
    
    return ...;
  }
)
```

---

## โ ุงููุฒุงูุง

1. **ุฏููุงููููุฉ ูุงููุฉ** - ุงูุชุบููุฑุงุช ุชุญุฏุซ ููุฑุงู
2. **ุนุฏู ุงูุชุฑุงูู** - ุฅุนุงุฏุฉ ุงูุชููุฆุฉ ูุจู ูู ุชูููู
3. **ุงูุญุงูุฉ ุงูุงูุชุฑุงุถูุฉ** - ุฏุงุฆูุงู ูุฑุฌุน ููุญุงูุฉ ุงูุฃุตููุฉ
4. **setState ุชููุงุฆู** - Provider ูุชุนุงูู ูุน ูู ุดูุก
5. **ุฃุฏุงุก ููุชุงุฒ** - ููุท ุงูุนูุงุตุฑ ุงููุฑุฆูุฉ ุชูุนุฑุถ

---

## ๐ฏ ุญุงูุงุช ุงูุงุณุชุฎุฏุงู

### โ ูุง ูููู ุนููู:

- โ ุชูุฑุงุฑ ูุฌููุนุฉ ุจูุงุกู ุนูู ุนุฏุฏ
- โ ุฅุธูุงุฑ/ุฅุฎูุงุก ุฃุณุฆูุฉ ุจูุงุกู ุนูู ุฅุฌุงุจุงุช ุณุงุจูุฉ
- โ ุฅุธูุงุฑ/ุฅุฎูุงุก ุฃูุณุงู ูุงููุฉ
- โ ุฌุนู ุฃุณุฆูุฉ ูุทููุจุฉ ุฏููุงููููุงู
- โ ุดุฑูุท ูุนูุฏุฉ ุจูุนุงููุงุช ูุชุนุฏุฏุฉ
- โ ุดุฑูุท ูุชุฏุงุฎูุฉ (ุดุฑุท ูุคุซุฑ ุนูู ุดุฑุท ุขุฎุฑ)

### โ ุงููููุฏ:

- ุงูุดุฑุท ูุฌุจ ุฃู ูุนุชูุฏ ุนูู ุณุคุงู **ุณุงุจู** ูู ุงูุชุฑุชูุจ
- ูุง ูููู ุฅูุดุงุก ุญููุงุช ููุฑุบุฉ (A ูุนุชูุฏ ุนูู B ู B ูุนุชูุฏ ุนูู A)
- ุงูุชูุฑุงุฑ ูุทุจู ููุท ุนูู Groups

---

## ๐ ุงุณุชูุดุงู ุงูุฃุฎุทุงุก

### ุงููุดููุฉ: ุงูุดุฑุท ูุง ูุนูู

โ **ุงูุญููู:**
1. ุชุฃูุฏ ุฃู `sourceQuestionId` ุตุญูุญ
2. ุชุฃูุฏ ุฃู `targetQuestionId` ุฃู `targetGroupId` ุฃู `targetSectionId` ุตุญูุญ
3. ุชุฃูุฏ ุฃู ุงููููุฉ ุงูููุฏุฎูุฉ ุชุทุงุจู `value` ูู ุงูุดุฑุท
4. ุชุฃูุฏ ุฃู ุงููุนุงูู (`operator`) ููุงุณุจ ูููุน ุงูุจูุงูุงุช

### ุงููุดููุฉ: ุงูุชูุฑุงุฑ ูุง ูุนูู

โ **ุงูุญููู:**
1. ุชุฃูุฏ ุฃู ุงูุณุคุงู ูู ููุน `Integer`
2. ุชุฃูุฏ ุฃู ุงููุนุงูู = `RepeatForCount`
3. ุชุฃูุฏ ุฃู ุงูุฅุฌุฑุงุก = `Repetition`
4. ุชุฃูุฏ ุฃู `targetType` = `Group`

---

## ๐ ูููุทูุฑูู

### ุฅุถุงูุฉ ูุนุงูู ุฌุฏูุฏ:

1. ุฃุถู ุงููููุฉ ูู `ConditionOperator` enum
2. ุฃุถู ุงูุชูููู ูู method `evaluate`
3. ุงุฎุชุจุฑ ูุน ุญุงูุงุช ูุฎุชููุฉ

### ุฅุถุงูุฉ ุฅุฌุฑุงุก ุฌุฏูุฏ:

1. ุฃุถู ุงููููุฉ ูู `ConditionAction` enum
2. ุฃุถู ุงููุนุงูุฌุฉ ูู `_applyQuestionAction` / `_applyGroupAction` / `_applySectionAction`
3. ุฃุถู ุงููุนุงูุฌุฉ ุงูุนูุณูุฉ ูู `_applyReverseQuestionAction` / ุฅูุฎ

---

**๐ ูุธุงู ุงูุดุฑูุท ุฌุงูุฒ ููุนูู ุจููุงุกุฉ ุนุงููุฉ!**
